<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashflow Dashboard - DRONE AGRASS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .controls-row:last-child {
            margin-bottom: 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .control-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
        
        select, input, button {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-title {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #059669;
        }
        
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .tab.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        
        th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
        }
        
        th:hover {
            background: #f3f4f6;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        .chart-container {
            padding: 1.5rem;
            height: 400px;
        }
        
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            gap: 1rem;
        }
        
        .pagination-info {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .pagination-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .group-controls {
            background: #f3f4f6;
            padding: 1rem;
            margin: 1rem;
            border-radius: 6px;
        }
        
        .group-table {
            margin-top: 1rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        .sort-indicator {
            margin-left: 0.5rem;
            opacity: 0.5;
        }
        
        .money {
            color: #059669;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .pagination {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load React, ReactDOM, Babel, Recharts, dan FileSaver dari CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <!-- Data Excel yang sudah dikonversi -->
    <script>
        window.RAW_DATA = {
            "analisa biaya": {
                "headers": ["Item", "Jumlah", "Harga", "Total"],
                "data": [
                    ["DJI AGRAS T30", null, null, null],
                    ["jam kerja/hari", 6, null, null],
                    ["hari kerja", 22, null, null],
                    ["bbm/hm", 11, null, null],
                    ["bbm/liter", 11000, null, null],
                    ["total bbm", 11, 11000, 1452000],
                    ["upah operator", 1, 12000000, 12000000],
                    ["upah helper", 1, 5000000, 5000000],
                    ["oli", 1, 500000, 500000],
                    ["air", 1, 100000, 100000],
                    ["spare part", 1, 1000000, 1000000],
                    ["total", null, null, 20052000],
                    ["produksi/hari (ha)", 15, null, null],
                    ["produksi/bulan (ha)", 330, null, null],
                    ["biaya/ha", 60763.64, null, null],
                    ["harga jual", 85000, null, null],
                    ["laba kotor", 24236.36, null, null],
                    ["laba kotor/bulan", 7998000, null, null],
                    ["laba/alat/bulan", 2666000, null, null],
                    ["laba/alat/tahun", 31992000, null, null]
                ]
            },
            "ASUMSI": {
                "headers": ["No", "Item", "Satuan", "Nilai"],
                "data": [
                    ["1", "JUMLAH HARI KERJA /BULAN", "Hari", 22],
                    ["2", "ALAT DJI AGRAS T30", "Unit", 3],
                    ["3", "JAM KERJA /HARI", "Jam", 6],
                    ["4", "PRODUKTIVITAS /HARI", "Ha", 15],
                    ["5", "HARGA JUAL", "Rp/Ha", 85000],
                    ["6", "BBM /JAM", "Liter", 11],
                    ["7", "HARGA BBM", "Rp/Liter", 11000],
                    ["8", "UPAH OPERATOR", "Rp/Bulan", 12000000],
                    ["9", "UPAH HELPER", "Rp/Bulan", 5000000],
                    ["10", "BIAYA OLI", "Rp/Bulan", 500000],
                    ["11", "BIAYA AIR", "Rp/Bulan", 100000],
                    ["12", "SPARE PART", "Rp/Bulan", 1000000]
                ]
            },
            "cashflow 2 cash": {
                "headers": ["URAIAN", "Bulan 1", "Bulan 2", "Bulan 3", "Bulan 4", "Bulan 5", "Bulan 6"],
                "data": [
                    ["PENDAPATAN", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["Penjualan Jasa Pupuk", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["PENGELUARAN", 20052000, 20052000, 20052000, 20052000, 20052000, 20052000],
                    ["BBM", 1452000, 1452000, 1452000, 1452000, 1452000, 1452000],
                    ["Upah Operator", 12000000, 12000000, 12000000, 12000000, 12000000, 12000000],
                    ["Upah Helper", 5000000, 5000000, 5000000, 5000000, 5000000, 5000000],
                    ["Oli", 500000, 500000, 500000, 500000, 500000, 500000],
                    ["Air", 100000, 100000, 100000, 100000, 100000, 100000],
                    ["Spare Part", 1000000, 1000000, 1000000, 1000000, 1000000, 1000000],
                    ["CASHFLOW", 7998000, 7998000, 7998000, 7998000, 7998000, 7998000],
                    ["CASHFLOW KUMULATIF", 7998000, 15996000, 23994000, 31992000, 39990000, 47988000]
                ]
            },
            "cashflow 1 leasing": {
                "headers": ["URAIAN", "Bulan 1", "Bulan 2", "Bulan 3", "Bulan 4", "Bulan 5", "Bulan 6"],
                "data": [
                    ["PENDAPATAN", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["Penjualan Jasa Pupuk", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["PENGELUARAN", 24052000, 24052000, 24052000, 24052000, 24052000, 24052000],
                    ["BBM", 1452000, 1452000, 1452000, 1452000, 1452000, 1452000],
                    ["Upah Operator", 12000000, 12000000, 12000000, 12000000, 12000000, 12000000],
                    ["Upah Helper", 5000000, 5000000, 5000000, 5000000, 5000000, 5000000],
                    ["Oli", 500000, 500000, 500000, 500000, 500000, 500000],
                    ["Air", 100000, 100000, 100000, 100000, 100000, 100000],
                    ["Spare Part", 1000000, 1000000, 1000000, 1000000, 1000000, 1000000],
                    ["Leasing Drone", 4000000, 4000000, 4000000, 4000000, 4000000, 4000000],
                    ["CASHFLOW", 3998000, 3998000, 3998000, 3998000, 3998000, 3998000],
                    ["CASHFLOW KUMULATIF", 3998000, 7996000, 11994000, 15992000, 19990000, 23988000]
                ]
            },
            "ANALISA": {
                "headers": ["Item", "Biaya_Unit", "Keterangan"],
                "data": [
                    ["BBM", 5000000, "PEMAKAIAN 11 LITER/JAM & 14JAM KERJA PERHARI"],
                    ["GAJI OPERATOR", 20000000, "1 OPERATOR DAN 1 HELPER"],
                    ["PERAWATAN", 2000000, "SPARE PART DAN SERVICE"],
                    ["ASURANSI", 1000000, "ASURANSI ALAT"],
                    ["DEPRESIASI", 3000000, "PENYUSUTAN ALAT 5 TAHUN"]
                ]
            },
            "KOMPARASI": {
                "headers": ["Scenario", "Modal_Kerja", "Cashflow_Bulanan", "ROI_Tahunan"],
                "data": [
                    ["Beli Cash", 400000000, 7998000, "23.99%"],
                    ["Leasing", 100000000, 3998000, "47.98%"],
                    ["Sewa", 50000000, 2000000, "48.00%"]
                ]
            }
        };
    </script>

    <!-- Komponen React CashflowDashboard -->
    <script type="text/babel" data-presets="typescript,react">
        const { useState, useMemo, useEffect } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // Utility functions
        const formatCurrency = (value) => {
            if (value === null || value === undefined || isNaN(value)) return '-';
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        };

        const formatNumber = (value) => {
            if (value === null || value === undefined || isNaN(value)) return '-';
            return new Intl.NumberFormat('id-ID').format(value);
        };

        const isDateColumn = (header) => {
            return header.toLowerCase().includes('tanggal') ||
                   header.toLowerCase().includes('date') ||
                   /bulan\s*\d+/i.test(header);
        };

        const isNumericValue = (value) => {
            return typeof value === 'number' && !isNaN(value);
        };

        // Convert compact data to objects
        const convertToObjects = (compactData) => {
            const result = {};
            for (const [sheetName, sheetData] of Object.entries(compactData)) {
                if (sheetData.headers && sheetData.data) {
                    result[sheetName] = sheetData.data.map(row => {
                        const obj = {};
                        sheetData.headers.forEach((header, index) => {
                            obj[header] = row[index];
                        });
                        return obj;
                    });
                } else {
                    result[sheetName] = sheetData;
                }
            }
            return result;
        };

        const TestChart = () => {
            const data = [
                { name: 'Page A', uv: 4000, pv: 2400, amt: 2400 },
                { name: 'Page B', uv: 3000, pv: 1398, amt: 2210 },
                { name: 'Page C', uv: 2000, pv: 9800, amt: 2290 },
                { name: 'Page D', uv: 2780, pv: 3908, amt: 2000 },
                { name: 'Page E', uv: 1890, pv: 4800, amt: 2181 },
                { name: 'Page F', uv: 2390, pv: 3800, amt: 2500 },
                { name: 'Page G', uv: 3490, pv: 4300, amt: 2100 },
            ];

            return (
                <div style={{ width: '100%', height: 300 }}>
                    <ResponsiveContainer>
                        <LineChart
                            data={data}
                            margin={{
                                top: 5,
                                right: 30,
                                left: 20,
                                bottom: 5,
                            }}
                        >
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis dataKey="name" />
                            <YAxis />
                            <Tooltip />
                            <Legend />
                            <Line type="monotone" dataKey="pv" stroke="#8884d8" activeDot={{ r: 8 }} />
                            <Line type="monotone" dataKey="uv" stroke="#82ca9d" />
                        </LineChart>
                    </ResponsiveContainer>
                </div>
            );
        };

        // Render aplikasi
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TestChart />);
    </script>
</body>
</html>
