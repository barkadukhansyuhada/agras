<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashflow Dashboard - DRONE AGRASS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .controls-row:last-child {
            margin-bottom: 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .control-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
        
        select, input, button {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
            ring: 2px solid rgba(59, 130, 246, 0.1);
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-title {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #059669;
        }
        
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .tab.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        
        th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
        }
        
        th:hover {
            background: #f3f4f6;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        .chart-container {
            padding: 1.5rem;
            height: 400px;
        }
        
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            gap: 1rem;
        }
        
        .pagination-info {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .pagination-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .group-controls {
            background: #f3f4f6;
            padding: 1rem;
            margin: 1rem;
            border-radius: 6px;
        }
        
        .group-table {
            margin-top: 1rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        .sort-indicator {
            margin-left: 0.5rem;
            opacity: 0.5;
        }
        
        .money {
            color: #059669;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .pagination {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load React, ReactDOM, Babel, Recharts, dan FileSaver dari CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <!-- Data Excel yang sudah dikonversi -->
    <script>
        window.RAW_DATA = {
            "analisa biaya": {
                "headers": ["Item", "Jumlah", "Harga", "Total"],
                "data": [
                    ["DJI AGRAS T30", null, null, null],
                    ["jam kerja/hari", 6, null, null],
                    ["hari kerja", 22, null, null],
                    ["bbm/hm", 11, null, null],
                    ["bbm/liter", 11000, null, null],
                    ["total bbm", 11, 11000, 1452000],
                    ["upah operator", 1, 12000000, 12000000],
                    ["upah helper", 1, 5000000, 5000000],
                    ["oli", 1, 500000, 500000],
                    ["air", 1, 100000, 100000],
                    ["spare part", 1, 1000000, 1000000],
                    ["total", null, null, 20052000],
                    ["produksi/hari (ha)", 15, null, null],
                    ["produksi/bulan (ha)", 330, null, null],
                    ["biaya/ha", 60763.64, null, null],
                    ["harga jual", 85000, null, null],
                    ["laba kotor", 24236.36, null, null],
                    ["laba kotor/bulan", 7998000, null, null],
                    ["laba/alat/bulan", 2666000, null, null],
                    ["laba/alat/tahun", 31992000, null, null]
                ]
            },
            "ASUMSI": {
                "headers": ["No", "Item", "Satuan", "Nilai"],
                "data": [
                    ["1", "JUMLAH HARI KERJA /BULAN", "Hari", 22],
                    ["2", "ALAT DJI AGRAS T30", "Unit", 3],
                    ["3", "JAM KERJA /HARI", "Jam", 6],
                    ["4", "PRODUKTIVITAS /HARI", "Ha", 15],
                    ["5", "HARGA JUAL", "Rp/Ha", 85000],
                    ["6", "BBM /JAM", "Liter", 11],
                    ["7", "HARGA BBM", "Rp/Liter", 11000],
                    ["8", "UPAH OPERATOR", "Rp/Bulan", 12000000],
                    ["9", "UPAH HELPER", "Rp/Bulan", 5000000],
                    ["10", "BIAYA OLI", "Rp/Bulan", 500000],
                    ["11", "BIAYA AIR", "Rp/Bulan", 100000],
                    ["12", "SPARE PART", "Rp/Bulan", 1000000]
                ]
            },
            "cashflow 2 cash": {
                "headers": ["URAIAN", "Bulan 1", "Bulan 2", "Bulan 3", "Bulan 4", "Bulan 5", "Bulan 6"],
                "data": [
                    ["PENDAPATAN", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["Penjualan Jasa Pupuk", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["PENGELUARAN", 20052000, 20052000, 20052000, 20052000, 20052000, 20052000],
                    ["BBM", 1452000, 1452000, 1452000, 1452000, 1452000, 1452000],
                    ["Upah Operator", 12000000, 12000000, 12000000, 12000000, 12000000, 12000000],
                    ["Upah Helper", 5000000, 5000000, 5000000, 5000000, 5000000, 5000000],
                    ["Oli", 500000, 500000, 500000, 500000, 500000, 500000],
                    ["Air", 100000, 100000, 100000, 100000, 100000, 100000],
                    ["Spare Part", 1000000, 1000000, 1000000, 1000000, 1000000, 1000000],
                    ["CASHFLOW", 7998000, 7998000, 7998000, 7998000, 7998000, 7998000],
                    ["CASHFLOW KUMULATIF", 7998000, 15996000, 23994000, 31992000, 39990000, 47988000]
                ]
            },
            "cashflow 1 leasing": {
                "headers": ["URAIAN", "Bulan 1", "Bulan 2", "Bulan 3", "Bulan 4", "Bulan 5", "Bulan 6"],
                "data": [
                    ["PENDAPATAN", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["Penjualan Jasa Pupuk", 28050000, 28050000, 28050000, 28050000, 28050000, 28050000],
                    ["PENGELUARAN", 24052000, 24052000, 24052000, 24052000, 24052000, 24052000],
                    ["BBM", 1452000, 1452000, 1452000, 1452000, 1452000, 1452000],
                    ["Upah Operator", 12000000, 12000000, 12000000, 12000000, 12000000, 12000000],
                    ["Upah Helper", 5000000, 5000000, 5000000, 5000000, 5000000, 5000000],
                    ["Oli", 500000, 500000, 500000, 500000, 500000, 500000],
                    ["Air", 100000, 100000, 100000, 100000, 100000, 100000],
                    ["Spare Part", 1000000, 1000000, 1000000, 1000000, 1000000, 1000000],
                    ["Leasing Drone", 4000000, 4000000, 4000000, 4000000, 4000000, 4000000],
                    ["CASHFLOW", 3998000, 3998000, 3998000, 3998000, 3998000, 3998000],
                    ["CASHFLOW KUMULATIF", 3998000, 7996000, 11994000, 15992000, 19990000, 23988000]
                ]
            },
            "ANALISA": {
                "headers": ["Item", "Biaya_Unit", "Keterangan"],
                "data": [
                    ["BBM", 5000000, "PEMAKAIAN 11 LITER/JAM & 14JAM KERJA PERHARI"],
                    ["GAJI OPERATOR", 20000000, "1 OPERATOR DAN 1 HELPER"],
                    ["PERAWATAN", 2000000, "SPARE PART DAN SERVICE"],
                    ["ASURANSI", 1000000, "ASURANSI ALAT"],
                    ["DEPRESIASI", 3000000, "PENYUSUTAN ALAT 5 TAHUN"]
                ]
            },
            "KOMPARASI": {
                "headers": ["Scenario", "Modal_Kerja", "Cashflow_Bulanan", "ROI_Tahunan"],
                "data": [
                    ["Beli Cash", 400000000, 7998000, "23.99%"],
                    ["Leasing", 100000000, 3998000, "47.98%"],
                    ["Sewa", 50000000, 2000000, "48.00%"]
                ]
            }
        };
    </script>

    <!-- Komponen React CashflowDashboard -->
    <script type="text/babel" data-presets="typescript,react">
        const { useState, useMemo, useEffect } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // Utility functions
        const formatCurrency = (value) => {
            if (value === null || value === undefined || isNaN(value)) return '-';
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        };

        const formatNumber = (value) => {
            if (value === null || value === undefined || isNaN(value)) return '-';
            return new Intl.NumberFormat('id-ID').format(value);
        };

        const isDateColumn = (header) => {
            return header.toLowerCase().includes('tanggal') || 
                   header.toLowerCase().includes('date') ||
                   /bulan\s*\d+/i.test(header);
        };

        const isNumericValue = (value) => {
            return typeof value === 'number' && !isNaN(value);
        };

        // Convert compact data to objects
        const convertToObjects = (compactData) => {
            const result = {};
            for (const [sheetName, sheetData] of Object.entries(compactData)) {
                if (sheetData.headers && sheetData.data) {
                    result[sheetName] = sheetData.data.map(row => {
                        const obj = {};
                        sheetData.headers.forEach((header, index) => {
                            obj[header] = row[index];
                        });
                        return obj;
                    });
                } else {
                    result[sheetName] = sheetData;
                }
            }
            return result;
        };

        const CashflowDashboard = () => {
            const [selectedSheet, setSelectedSheet] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });
            const [currentPage, setCurrentPage] = useState(1);
            const [pageSize, setPageSize] = useState(25);
            const [activeTab, setActiveTab] = useState('table');
            const [groupBy, setGroupBy] = useState('');
            const [aggregateFunction, setAggregateFunction] = useState('SUM');

            // Convert data
            const data = useMemo(() => convertToObjects(window.RAW_DATA), []);
            const sheets = Object.keys(data);

            useEffect(() => {
                if (sheets.length > 0 && !selectedSheet) {
                    setSelectedSheet(sheets[0]);
                }
            }, [sheets]);

            const currentData = selectedSheet ? data[selectedSheet] || [] : [];
            
            // Search and filter
            const filteredData = useMemo(() => {
                if (!searchTerm) return currentData;
                
                return currentData.filter(row =>
                    Object.values(row).some(value =>
                        value && value.toString().toLowerCase().includes(searchTerm.toLowerCase())
                    )
                );
            }, [currentData, searchTerm]);

            // Sort
            const sortedData = useMemo(() => {
                if (!sortConfig.key) return filteredData;

                return [...filteredData].sort((a, b) => {
                    const aVal = a[sortConfig.key];
                    const bVal = b[sortConfig.key];

                    if (aVal === null || aVal === undefined) return 1;
                    if (bVal === null || bVal === undefined) return -1;

                    if (isNumericValue(aVal) && isNumericValue(bVal)) {
                        return sortConfig.direction === 'asc' ? aVal - bVal : bVal - aVal;
                    }

                    const aStr = aVal.toString().toLowerCase();
                    const bStr = bVal.toString().toLowerCase();
                    
                    if (sortConfig.direction === 'asc') {
                        return aStr < bStr ? -1 : aStr > bStr ? 1 : 0;
                    } else {
                        return aStr > bStr ? -1 : aStr < bStr ? 1 : 0;
                    }
                });
            }, [filteredData, sortConfig]);

            // Pagination
            const paginatedData = useMemo(() => {
                const start = (currentPage - 1) * pageSize;
                return sortedData.slice(start, start + pageSize);
            }, [sortedData, currentPage, pageSize]);

            const totalPages = Math.ceil(sortedData.length / pageSize);

            // KPI calculations
            const kpis = useMemo(() => {
                if (currentData.length === 0) return {};

                const numericColumns = {};
                
                // Find numeric columns
                Object.keys(currentData[0] || {}).forEach(key => {
                    const values = currentData.map(row => row[key]).filter(val => isNumericValue(val));
                    if (values.length > 0) {
                        numericColumns[key] = {
                            sum: values.reduce((sum, val) => sum + val, 0),
                            avg: values.reduce((sum, val) => sum + val, 0) / values.length,
                            min: Math.min(...values),
                            max: Math.max(...values),
                            count: values.length
                        };
                    }
                });

                return numericColumns;
            }, [currentData]);

            // Chart data
            const chartData = useMemo(() => {
                if (currentData.length === 0) return [];

                const headers = Object.keys(currentData[0] || {});
                const dateColumns = headers.filter(isDateColumn);
                const numericColumns = headers.filter(header => 
                    currentData.some(row => isNumericValue(row[header]))
                );

                if (dateColumns.length === 0 && numericColumns.length === 0) return [];

                // Use first date column or first column as X-axis
                const xColumn = dateColumns[0] || headers[0];
                
                return currentData.map(row => {
                    const item = { name: row[xColumn] || 'N/A' };
                    numericColumns.forEach(col => {
                        if (isNumericValue(row[col])) {
                            item[col] = row[col];
                        }
                    });
                    return item;
                }).filter(item => Object.keys(item).length > 1);
            }, [currentData]);

            // Group and aggregate
            const groupedData = useMemo(() => {
                if (!groupBy || currentData.length === 0) return [];

                const groups = {};
                currentData.forEach(row => {
                    const groupValue = row[groupBy] || 'N/A';
                    if (!groups[groupValue]) {
                        groups[groupValue] = [];
                    }
                    groups[groupValue].push(row);
                });

                return Object.entries(groups).map(([groupValue, rows]) => {
                    const result = { [groupBy]: groupValue, Count: rows.length };
                    
                    // Calculate aggregates for numeric columns
                    Object.keys(rows[0] || {}).forEach(key => {
                        if (key === groupBy) return;
                        
                        const numericValues = rows.map(row => row[key]).filter(val => isNumericValue(val));
                        if (numericValues.length > 0) {
                            switch (aggregateFunction) {
                                case 'SUM':
                                    result[key] = numericValues.reduce((sum, val) => sum + val, 0);
                                    break;
                                case 'AVG':
                                    result[key] = numericValues.reduce((sum, val) => sum + val, 0) / numericValues.length;
                                    break;
                                case 'MIN':
                                    result[key] = Math.min(...numericValues);
                                    break;
                                case 'MAX':
                                    result[key] = Math.max(...numericValues);
                                    break;
                            }
                        }
                    });
                    
                    return result;
                });
            }, [currentData, groupBy, aggregateFunction]);

            const handleSort = (key) => {
                setSortConfig({
                    key,
                    direction: sortConfig.key === key && sortConfig.direction === 'asc' ? 'desc' : 'asc'
                });
            };

            const exportData = (format) => {
                const dataToExport = activeTab === 'group' ? groupedData : sortedData;
                
                if (format === 'CSV') {
                    if (dataToExport.length === 0) return;
                    
                    const headers = Object.keys(dataToExport[0]);
                    const csv = [
                        headers.join(','),
                        ...dataToExport.map(row => 
                            headers.map(header => {
                                const value = row[header];
                                if (value === null || value === undefined) return '';
                                return `"${value.toString().replace(/"/g, '""')}"`;
                            }).join(',')
                        )
                    ].join('\n');
                    
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    saveAs(blob, `${selectedSheet}_${format.toLowerCase()}.csv`);
                } else if (format === 'JSON') {
                    const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { 
                        type: 'application/json;charset=utf-8;' 
                    });
                    saveAs(blob, `${selectedSheet}_${format.toLowerCase()}.json`);
                }
            };

            const headers = currentData.length > 0 ? Object.keys(currentData[0]) : [];
            const numericHeaders = headers.filter(header => 
                currentData.some(row => isNumericValue(row[header]))
            );

            return (
                <div className="container">
                    <div className="header">
                        <h1>Dashboard Cashflow DRONE AGRASS</h1>
                        <p>Analisis Proyeksi Keuangan Drone Pupuk - Region Sumsel</p>
                    </div>

                    {/* Controls */}
                    <div className="controls">
                        <div className="controls-row">
                            <div className="control-group">
                                <label>Pilih Sheet:</label>
                                <select 
                                    value={selectedSheet} 
                                    onChange={(e) => {
                                        setSelectedSheet(e.target.value);
                                        setCurrentPage(1);
                                        setSearchTerm('');
                                        setSortConfig({ key: null, direction: 'asc' });
                                    }}
                                >
                                    {sheets.map(sheet => (
                                        <option key={sheet} value={sheet}>{sheet}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="control-group">
                                <label>Pencarian:</label>
                                <input
                                    type="text"
                                    placeholder="Cari data..."
                                    value={searchTerm}
                                    onChange={(e) => {
                                        setSearchTerm(e.target.value);
                                        setCurrentPage(1);
                                    }}
                                />
                            </div>
                            
                            <div className="control-group">
                                <label>Rows per page:</label>
                                <select 
                                    value={pageSize} 
                                    onChange={(e) => {
                                        setPageSize(Number(e.target.value));
                                        setCurrentPage(1);
                                    }}
                                >
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>

                        <div className="controls-row">
                            <div className="control-group">
                                <label>Group By:</label>
                                <select 
                                    value={groupBy} 
                                    onChange={(e) => setGroupBy(e.target.value)}
                                >
                                    <option value="">-- Pilih Kolom --</option>
                                    {headers.map(header => (
                                        <option key={header} value={header}>{header}</option>
                                    ))}
                                </select>
                            </div>
                            
                            {groupBy && (
                                <div className="control-group">
                                    <label>Aggregate:</label>
                                    <select 
                                        value={aggregateFunction} 
                                        onChange={(e) => setAggregateFunction(e.target.value)}
                                    >
                                        <option value="SUM">SUM</option>
                                        <option value="AVG">AVG</option>
                                        <option value="MIN">MIN</option>
                                        <option value="MAX">MAX</option>
                                    </select>
                                </div>
                            )}
                            
                            <div className="control-group">
                                <label>Export:</label>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button onClick={() => exportData('CSV')}>CSV</button>
                                    <button onClick={() => exportData('JSON')}>JSON</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* KPI Stats */}
                    {Object.keys(kpis).length > 0 && (
                        <div className="stats">
                            {Object.entries(kpis).slice(0, 4).map(([column, stats]) => (
                                <div key={column} className="stat-card">
                                    <div className="stat-title">{column} (Total)</div>
                                    <div className="stat-value">{formatCurrency(stats.sum)}</div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Tabs */}
                    <div className="tabs">
                        <div 
                            className={`tab ${activeTab === 'table' ? 'active' : ''}`}
                            onClick={() => setActiveTab('table')}
                        >
                            Tabel Data
                        </div>
                        <div 
                            className={`tab ${activeTab === 'chart' ? 'active' : ''}`}
                            onClick={() => setActiveTab('chart')}
                        >
                            Grafik
                        </div>
                        {groupBy && (
                            <div 
                                className={`tab ${activeTab === 'group' ? 'active' : ''}`}
                                onClick={() => setActiveTab('group')}
                            >
                                Grup & Agregasi
                            </div>
                        )}
                    </div>

                    {/* Content */}
                    <div className="content">
                        {activeTab === 'table' && (
                            <>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                {headers.map(header => (
                                                    <th 
                                                        key={header}
                                                        onClick={() => handleSort(header)}
                                                    >
                                                        {header}
                                                        {sortConfig.key === header && (
                                                            <span className="sort-indicator">
                                                                {sortConfig.direction === 'asc' ? '↑' : '↓'}
                                                            </span>
                                                        )}
                                                    </th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {paginatedData.map((row, index) => (
                                                <tr key={index}>
                                                    {headers.map(header => {
                                                        const value = row[header];
                                                        const isNumeric = isNumericValue(value);
                                                        return (
                                                            <td 
                                                                key={header}
                                                                className={isNumeric ? 'money' : ''}
                                                            >
                                                                {isNumeric ? formatNumber(value) : (value || '-')}
                                                            </td>
                                                        );
                                                    })}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div className="pagination">
                                    <div className="pagination-info">
                                        Menampilkan {Math.min((currentPage - 1) * pageSize + 1, sortedData.length)} - {Math.min(currentPage * pageSize, sortedData.length)} dari {sortedData.length} data
                                    </div>
                                    <div className="pagination-controls">
                                        <button 
                                            onClick={() => setCurrentPage(1)}
                                            disabled={currentPage === 1}
                                        >
                                            ⏮️
                                        </button>
                                        <button 
                                            onClick={() => setCurrentPage(currentPage - 1)}
                                            disabled={currentPage === 1}
                                        >
                                            ⬅️
                                        </button>
                                        <span>Page {currentPage} of {totalPages}</span>
                                        <button 
                                            onClick={() => setCurrentPage(currentPage + 1)}
                                            disabled={currentPage === totalPages}
                                        >
                                            ➡️
                                        </button>
                                        <button 
                                            onClick={() => setCurrentPage(totalPages)}
                                            disabled={currentPage === totalPages}
                                        >
                                            ⏭️
                                        </button>
                                    </div>
                                </div>
                            </>
                        )}

                        {activeTab === 'chart' && (
                            <div className="chart-container">
                                {chartData.length > 0 ? (
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={chartData}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="name" />
                                            <YAxis />
                                            <Tooltip formatter={(value) => formatNumber(value)} />
                                            <Legend />
                                            {numericHeaders.slice(0, 5).map((header, index) => {
                                                const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6'];
                                                return (
                                                    <Line 
                                                        key={header}
                                                        type="monotone" 
                                                        dataKey={header} 
                                                        stroke={colors[index % colors.length]}
                                                        strokeWidth={2}
                                                    />
                                                );
                                            })}
                                        </LineChart>
                                    </ResponsiveContainer>
                                ) : (
                                    <div className="loading">
                                        Tidak ada data numerik untuk ditampilkan dalam grafik
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'group' && groupBy && (
                            <>
                                <div className="group-controls">
                                    <p><strong>Grouped by:</strong> {groupBy} | <strong>Aggregate:</strong> {aggregateFunction}</p>
                                </div>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                {groupedData.length > 0 && Object.keys(groupedData[0]).map(header => (
                                                    <th key={header}>{header}</th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {groupedData.map((row, index) => (
                                                <tr key={index}>
                                                    {Object.entries(row).map(([key, value]) => {
                                                        const isNumeric = isNumericValue(value);
                                                        return (
                                                            <td 
                                                                key={key}
                                                                className={isNumeric ? 'money' : ''}
                                                            >
                                                                {isNumeric ? formatNumber(value) : (value || '-')}
                                                            </td>
                                                        );
                                                    })}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Render aplikasi
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CashflowDashboard />);
    </script>
</body>
</html>